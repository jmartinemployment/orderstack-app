<div class="setup-wizard">
  <!-- Success Screen -->
  @if (_submitSuccess()) {
    <div class="success-screen">
      <div class="success-icon">
        <i class="bi bi-check-circle-fill"></i>
      </div>
      <h2>You're all set!</h2>
      <p>Your business is ready. Let's sign you in.</p>
      <button type="button" class="btn btn-primary btn-lg mt-4" (click)="goToDashboard()">
        Let's Go <i class="bi bi-arrow-right"></i>
      </button>
    </div>
  } @else {
    <!-- Brand + Progress -->
    <div class="wizard-brand">
      <i class="bi bi-stack"></i> OrderStack
    </div>
    <div class="wizard-header">
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="progressPercent()"></div>
      </div>
      <div class="step-label">
        <span>Step {{ currentStep() }} of {{ totalSteps }}</span>
        <span>{{ progressPercent() }}% complete</span>
      </div>
    </div>

    <div class="wizard-body">
      <!-- ============ STEP 1: Welcome + Business Name + Address ============ -->
      @if (currentStep() === 1) {
        <div class="step-content welcome-step">
          <h2>Welcome to OrderStack!</h2>
          <p class="step-subtitle">Let's shape this thing to fit your business.</p>

          <div class="form-group">
            <label for="businessName">Your business name</label>
            <input
              id="businessName"
              type="text"
              class="form-control"
              placeholder="e.g. Taipa Kitchen"
              [ngModel]="_businessName()"
              (ngModelChange)="_businessName.set($event)" />
            <p class="field-hint">This is how we'll identify you on emails, receipts, and messages to your customers.</p>
          </div>

          <div class="address-section">
            <label>Business address</label>
            <input
              type="text"
              class="form-control"
              placeholder="Street address"
              [ngModel]="_businessAddress()"
              (ngModelChange)="_businessAddress.set($event)"
              [disabled]="_noPhysicalAddress()" />

            <div class="no-address-check">
              <input
                type="checkbox"
                id="noAddress"
                class="form-check-input"
                [ngModel]="_noPhysicalAddress()"
                (ngModelChange)="_noPhysicalAddress.set($event)" />
              <label for="noAddress" class="form-check-label">I don't have a permanent business address</label>
            </div>
          </div>
        </div>
      }

      <!-- ============ STEP 2: Business Type ============ -->
      @if (currentStep() === 2) {
        <div class="step-content">
          <h2>What kind of business best describes <strong>{{ _businessName() || 'your business' }}</strong>?</h2>
          <p class="step-subtitle">This helps us set up the right features for you.</p>

          <div class="business-type-search">
            <i class="bi bi-search search-icon"></i>
            <input
              type="text"
              class="form-control search-input"
              placeholder="Search business types..."
              [ngModel]="_businessTypeSearch()"
              (ngModelChange)="_businessTypeSearch.set($event)" />
          </div>

          <div class="business-type-list">
            @for (type of filteredBusinessTypes(); track type.name) {
              <button
                type="button"
                class="business-type-item"
                [class.selected]="_selectedBusinessType()?.name === type.name"
                (click)="selectBusinessType(type)">
                <div class="bt-info">
                  <span class="bt-name">{{ type.name }}</span>
                  <span class="bt-vertical">{{ getVerticalLabel(type.vertical) }}</span>
                </div>
                @if (_selectedBusinessType()?.name === type.name) {
                  <i class="bi bi-check-circle-fill bt-check"></i>
                }
              </button>
            }
            @if (filteredBusinessTypes().length === 0) {
              <div class="bt-empty">
                <p>No results for "{{ _businessTypeSearch() }}"</p>
              </div>
            }
          </div>
        </div>
      }

      <!-- ============ STEP 3: Annual Revenue ============ -->
      @if (currentStep() === 3) {
        <div class="step-content">
          <h2>What's your annual revenue?</h2>
          <p class="step-subtitle">This helps us recommend the right plan and features. No judgment — we serve businesses of all sizes.</p>

          <div class="revenue-cards">
            @for (range of revenueRanges; track range.id) {
              <button
                type="button"
                class="revenue-card"
                [class.selected]="_selectedRevenue() === range.id"
                (click)="selectRevenue(range.id)">
                <span class="revenue-label">{{ range.label }}</span>
                <span class="revenue-desc">{{ range.description }}</span>
                @if (_selectedRevenue() === range.id) {
                  <i class="bi bi-check-circle-fill revenue-check"></i>
                }
              </button>
            }
          </div>
        </div>
      }

      <!-- ============ STEP 4: Complexity ============ -->
      @if (currentStep() === 4) {
        <div class="step-content">
          <h2>How do you plan to use OrderStack?</h2>
          <p class="step-subtitle">This will help us customize your setup. You can always change this later.</p>

          <div class="complexity-cards">
            <button
              class="complexity-card"
              [class.selected]="_complexity() === 'full'"
              (click)="_complexity.set('full')">
              <div class="card-icon"><i class="bi bi-box-seam"></i></div>
              <h3>Full</h3>
              <p>Payments, catalog, and inventory management. Everything you need to run your business.</p>
              <span class="tag">Recommended</span>
            </button>

            <button
              class="complexity-card"
              [class.selected]="_complexity() === 'catalog'"
              (click)="_complexity.set('catalog')">
              <div class="card-icon"><i class="bi bi-list-ul"></i></div>
              <h3>Catalog</h3>
              <p>Payments and a product/service catalog. No inventory tracking.</p>
            </button>

            <button
              class="complexity-card"
              [class.selected]="_complexity() === 'payments_only'"
              (click)="_complexity.set('payments_only')">
              <div class="card-icon"><i class="bi bi-credit-card"></i></div>
              <h3>Payments Only</h3>
              <p>Just accept payments. No catalog or menu needed.</p>
            </button>
          </div>
        </div>
      }

      <!-- ============ STEP 5: Recommended Mode ============ -->
      @if (currentStep() === 5) {
        <div class="step-content">
          @if (!_showAllModes()) {
            <h2>Here's your ideal setup</h2>
            <p class="step-subtitle">Based on your selections, we recommend this mode. Free with optional paid plans.</p>

            @if (recommendedMode(); as rec) {
              <div class="recommended-mode-card" (click)="acceptRecommendedMode()">
                <div class="rec-mode-hero">
                  <i class="{{ rec.icon }}"></i>
                </div>
                <h3>{{ rec.label }}</h3>
                <p class="rec-mode-desc">{{ rec.description }}</p>
                <div class="rec-mode-features">
                  @for (feature of rec.highlights; track feature) {
                    <span class="rec-feature"><i class="bi bi-check2"></i> {{ feature }}</span>
                  }
                </div>
              </div>
            }

            <div class="select-another-mode">
              <span class="another-mode-label">Not the right fit?</span>
              <button class="another-mode-link" (click)="toggleAllModes()">
                Select another mode <i class="bi bi-chevron-right"></i>
              </button>
            </div>
          } @else {
            <h2>Select a mode</h2>
            <p class="step-subtitle">The mode you select will be used on this device. You can add multiple modes later and switch between them anytime.</p>

            <h4 class="mode-group-label">Based on what you sell</h4>
            <div class="mode-grid">
              @for (m of availableModes(); track m.mode) {
                <button
                  class="mode-card"
                  [class.selected]="_selectedMode() === m.mode"
                  (click)="selectMode(m.mode)">
                  <i class="{{ m.icon }} mode-icon"></i>
                  <h3>{{ m.label }}</h3>
                  <p>{{ m.description }}</p>
                  @if (_selectedMode() === m.mode) {
                    <i class="bi bi-check-circle-fill check-icon"></i>
                  }
                </button>
              }
            </div>

            @if (otherModes().length > 0) {
              <h4 class="mode-group-label">Other options</h4>
              <div class="mode-grid">
                @for (m of otherModes(); track m.mode) {
                  <button
                    class="mode-card"
                    [class.selected]="_selectedMode() === m.mode"
                    (click)="selectMode(m.mode)">
                    <i class="{{ m.icon }} mode-icon"></i>
                    <h3>{{ m.label }}</h3>
                    <p>{{ m.description }}</p>
                    @if (_selectedMode() === m.mode) {
                      <i class="bi bi-check-circle-fill check-icon"></i>
                    }
                  </button>
                }
              </div>
            }
          }
        </div>
      }

      <!-- ============ STEP 6: Tax & Locale ============ -->
      @if (currentStep() === 6) {
        <div class="step-content">
          <h2>Tax & locale settings</h2>
          <p class="step-subtitle">We'll calculate tax automatically on every transaction.</p>

          <div class="form-group">
            <label>Tax Rate (%)</label>
            <div class="tax-row">
              <input
                type="number"
                class="form-control tax-input"
                step="0.01"
                min="0"
                max="20"
                [ngModel]="_taxLocale().taxRate"
                (ngModelChange)="updateTaxLocale('taxRate', $event)" />
              <button class="btn btn-outline auto-detect-btn" (click)="autoDetectTax()" [disabled]="_isAutoDetecting()">
                @if (_isAutoDetecting()) {
                  <i class="bi bi-arrow-repeat spin"></i> Detecting...
                } @else {
                  <i class="bi bi-geo-alt"></i> Auto-detect
                }
              </button>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group flex-1">
              <label>Currency</label>
              <select
                class="form-control"
                [ngModel]="_taxLocale().currency"
                (ngModelChange)="updateTaxLocale('currency', $event)">
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (€)</option>
                <option value="GBP">GBP (£)</option>
                <option value="CAD">CAD (C$)</option>
              </select>
            </div>
            <div class="form-group flex-1">
              <label>Language</label>
              <select
                class="form-control"
                [ngModel]="_taxLocale().defaultLanguage"
                (ngModelChange)="updateTaxLocale('defaultLanguage', $event)">
                <option value="en">English</option>
                <option value="es">Español</option>
              </select>
            </div>
          </div>

          <div class="form-check">
            <input
              type="checkbox"
              id="taxInclusive"
              class="form-check-input"
              [ngModel]="_taxLocale().taxInclusive"
              (ngModelChange)="updateTaxLocale('taxInclusive', $event)" />
            <label for="taxInclusive" class="form-check-label">
              Tax included in listed prices
            </label>
          </div>
        </div>
      }

      <!-- ============ STEP 7: Business Hours ============ -->
      @if (currentStep() === 7) {
        <div class="step-content">
          <h2>When are you open?</h2>
          <p class="step-subtitle">Set your regular business hours.</p>

          <div class="presets">
            <button class="btn btn-sm btn-outline" (click)="applyHoursPreset('11:00', '22:00')">Restaurant (11am–10pm)</button>
            <button class="btn btn-sm btn-outline" (click)="applyHoursPreset('09:00', '21:00')">Retail (9am–9pm)</button>
            <button class="btn btn-sm btn-outline" (click)="applyHoursPreset('06:00', '18:00')">Early (6am–6pm)</button>
          </div>

          <div class="hours-grid">
            @for (day of _businessHours(); track day.day; let i = $index) {
              <div class="hours-row" [class.closed]="day.closed">
                <span class="day-label">{{ capitalizeDay(day.day) }}</span>
                <select
                  class="form-control time-select"
                  [ngModel]="day.open"
                  (ngModelChange)="updateHoursField(i, 'open', $event)"
                  [disabled]="day.closed">
                  @for (t of timeOptions; track t) {
                    <option [value]="t">{{ formatTime(t) }}</option>
                  }
                </select>
                <span class="time-sep">to</span>
                <select
                  class="form-control time-select"
                  [ngModel]="day.close"
                  (ngModelChange)="updateHoursField(i, 'close', $event)"
                  [disabled]="day.closed">
                  @for (t of timeOptions; track t) {
                    <option [value]="t">{{ formatTime(t) }}</option>
                  }
                </select>
                <button class="btn btn-sm btn-icon" [class.active]="day.closed" (click)="toggleClosed(i)" title="Toggle closed">
                  <i class="bi" [class.bi-toggle-off]="!day.closed" [class.bi-toggle-on]="day.closed"></i>
                </button>
                <button class="btn btn-sm btn-icon" (click)="copyToAll(i)" title="Copy to all days">
                  <i class="bi bi-copy"></i>
                </button>
              </div>
            }
          </div>
        </div>
      }

      <!-- ============ STEP 8: Payment ============ -->
      @if (currentStep() === 8) {
        <div class="step-content">
          <h2>How will you accept payments?</h2>
          <p class="step-subtitle">You can always change this later in Settings.</p>

          <div class="payment-options">
            <button
              class="payment-card"
              [class.selected]="_paymentProcessor() === 'paypal'"
              (click)="_paymentProcessor.set('paypal')">
              <div class="card-icon"><i class="bi bi-paypal"></i></div>
              <h3>PayPal Zettle</h3>
              <p>Tap, chip, and contactless payments. Recommended for most businesses.</p>
              <span class="tag">Recommended</span>
            </button>

            <button
              class="payment-card"
              [class.selected]="_paymentProcessor() === 'stripe'"
              (click)="_paymentProcessor.set('stripe')">
              <div class="card-icon"><i class="bi bi-stripe"></i></div>
              <h3>Stripe</h3>
              <p>Full payment platform with online and in-person support.</p>
            </button>

            <button
              class="payment-card"
              [class.selected]="_paymentProcessor() === 'none'"
              (click)="_paymentProcessor.set('none')">
              <div class="card-icon"><i class="bi bi-cash-stack"></i></div>
              <h3>Cash Only / Later</h3>
              <p>Skip payment setup for now. Accept cash or set up card payments later.</p>
            </button>
          </div>
        </div>
      }

      <!-- ============ STEP 9: Menu Setup ============ -->
      @if (currentStep() === 9) {
        <div class="step-content">
          @if (_complexity() === 'payments_only') {
            <h2>No menu needed</h2>
            <p class="step-subtitle">You selected Payments Only mode. You can add items later if needed.</p>
          } @else {
            <h2>Set up your menu</h2>
            <p class="step-subtitle">Start with a template or build from scratch.</p>

            <div class="template-grid">
              <button
                type="button"
                class="template-card"
                [class.selected]="_selectedTemplateId() === null"
                (click)="selectTemplate(null)">
                <i class="bi bi-plus-lg template-icon"></i>
                <h4>Start from Scratch</h4>
                <p>Build your menu manually</p>
              </button>

              @for (tmpl of _menuTemplates(); track tmpl.id) {
                <button
                  type="button"
                  class="template-card"
                  [class.selected]="_selectedTemplateId() === tmpl.id"
                  (click)="selectTemplate(tmpl.id)">
                  <i class="bi bi-file-earmark-text template-icon"></i>
                  <h4>{{ tmpl.name }}</h4>
                  <p>{{ tmpl.itemCount }} items &middot; {{ tmpl.categories.length }} categories</p>
                </button>
              }
            </div>
          }
        </div>
      }

      <!-- ============ STEP 10: Menu Builder / Template Preview ============ -->
      @if (currentStep() === 10) {
        <div class="step-content">
          @if (_selectedTemplateId() === null) {
            <h2>Build your menu</h2>
            <p class="step-subtitle">Add menu items, combos, and inventory ingredients. You can always add more later.</p>

            <!-- Type tabs -->
            <div class="type-tabs">
              <button
                type="button"
                class="type-tab"
                [class.active]="_quickAddType() === 'item'"
                (click)="_quickAddType.set('item')">
                <i class="bi bi-tag"></i> Common Menu Items
              </button>
              <button
                type="button"
                class="type-tab"
                [class.active]="_quickAddType() === 'inventory'"
                (click)="_quickAddType.set('inventory')">
                <i class="bi bi-box-seam"></i> Commonly Includes
              </button>
            </div>

            <!-- Suggestions -->
            @if (_quickAddType() === 'item') {
              <div class="suggestion-panel">
                @for (group of menuSuggestionsBeforeSides; track group.category) {
                  <div class="suggestion-group">
                    <span class="suggestion-group-label">{{ group.category }}</span>
                    <div class="suggestion-chips">
                      @for (s of group.items; track s.name) {
                        <button
                          type="button"
                          class="suggestion-chip"
                          [class.added]="addedItemNames().has(s.name)"
                          (click)="addSuggestion(s, 'item')">
                          @if (addedItemNames().has(s.name)) {
                            <i class="bi bi-check-lg"></i>
                          } @else {
                            <i class="bi bi-plus"></i>
                          }
                          {{ s.name }}
                        </button>
                      }
                    </div>
                  </div>
                }
                <div class="suggestion-group">
                  <span class="suggestion-group-label">Sides</span>
                  <div class="suggestion-chips">
                    @for (side of sideSuggestions; track side) {
                      <button
                        type="button"
                        class="suggestion-chip"
                        [class.added]="selectedSideNames().has(side)"
                        (click)="toggleSide(side)">
                        @if (selectedSideNames().has(side)) {
                          <i class="bi bi-check-lg"></i>
                        } @else {
                          <i class="bi bi-plus"></i>
                        }
                        {{ side }}
                      </button>
                    }
                  </div>
                </div>
                @for (group of menuSuggestionsAfterSides; track group.category) {
                  <div class="suggestion-group">
                    <span class="suggestion-group-label">{{ group.category }}</span>
                    <div class="suggestion-chips">
                      @for (s of group.items; track s.name) {
                        <button
                          type="button"
                          class="suggestion-chip"
                          [class.added]="addedItemNames().has(s.name)"
                          (click)="addSuggestion(s, 'item')">
                          @if (addedItemNames().has(s.name)) {
                            <i class="bi bi-check-lg"></i>
                          } @else {
                            <i class="bi bi-plus"></i>
                          }
                          {{ s.name }}
                        </button>
                      }
                    </div>
                  </div>
                }
              </div>
            }

            @if (_quickAddType() === 'inventory') {
              <div class="suggestion-panel">
                @for (group of inventorySuggestions; track group.category) {
                  <div class="suggestion-group">
                    <span class="suggestion-group-label">{{ group.category }}</span>
                    <div class="suggestion-chips">
                      @for (s of group.items; track s.name) {
                        <button
                          type="button"
                          class="suggestion-chip"
                          [class.added]="includedIngredientNames().has(s.name)"
                          (click)="toggleIngredient(s.name)">
                          @if (includedIngredientNames().has(s.name)) {
                            <i class="bi bi-check-lg"></i>
                          } @else {
                            <i class="bi bi-plus"></i>
                          }
                          {{ s.name }}
                        </button>
                      }
                    </div>
                  </div>
                }
              </div>
            }

            <!-- Menu item form -->
            <div class="quick-add-custom">
              <h5>Menu Item</h5>
            </div>
            <div class="quick-add-form">
              <div class="quick-add-row">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Item name (e.g. Cheeseburger)"
                  [ngModel]="_quickAddName()"
                  (ngModelChange)="_quickAddName.set($event)" />
                <input
                  type="number"
                  class="form-control quick-add-price"
                  placeholder="Price"
                  min="0"
                  step="0.01"
                  [ngModel]="_quickAddPrice() || null"
                  (ngModelChange)="_quickAddPrice.set($event ?? 0)" />
              </div>
              <div class="quick-add-row">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Category (e.g. Entrees)"
                  [ngModel]="_quickAddCategory()"
                  (ngModelChange)="_quickAddCategory.set($event)" />
              </div>
              <div class="quick-add-row">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Includes (e.g. lettuce, tomato, pickle, ketchup)"
                  [ngModel]="_quickAddIncludes()"
                  (ngModelChange)="_quickAddIncludes.set($event)" />
              </div>
              <div class="quick-add-row">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Side upgrades (e.g. Onion Rings, Sweet Potato Fries)"
                  [ngModel]="_quickAddSideUpgrades()"
                  (ngModelChange)="_quickAddSideUpgrades.set($event)" />
                <input
                  type="number"
                  class="form-control quick-add-price"
                  placeholder="Upcharge"
                  min="0"
                  step="0.25"
                  [ngModel]="_quickAddUpcharge() || null"
                  (ngModelChange)="_quickAddUpcharge.set($event ?? 0)" />
              </div>
              <div class="quick-add-row">
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  [disabled]="!_quickAddName().trim() || _quickAddPrice() <= 0"
                  (click)="addQuickItem()">
                  <i class="bi bi-plus-lg"></i> Add
                </button>
              </div>
            </div>

            <!-- Added items list -->
            @if (_quickAddItems().length > 0) {
              <div class="quick-add-group">
                <h5><i class="bi bi-tag"></i> Menu Items</h5>
                <div class="quick-add-list">
                  @for (item of _quickAddItems(); track $index) {
                    <div class="quick-add-item">
                      <div class="quick-add-item-info">
                        <span class="quick-add-item-name">{{ item.name }}</span>
                        <span class="quick-add-item-category">{{ item.category }}</span>
                        @if (item.includes) {
                          <span class="quick-add-item-detail">{{ item.includes }}</span>
                        }
                        @if (item.sideUpgrades) {
                          <span class="quick-add-item-detail quick-add-item-upgrades">
                            <i class="bi bi-arrow-up-circle"></i> {{ item.sideUpgrades }}
                          </span>
                        }
                      </div>
                      <span class="quick-add-item-price">{{ item.price | currency }}</span>
                      <button type="button" class="btn-icon-sm" (click)="removeQuickItem($index)">
                        <i class="bi bi-x-lg"></i>
                      </button>
                    </div>
                  }
                </div>
              </div>
            }

            @if (_quickAddItems().length === 0) {
              <div class="empty-state">
                <i class="bi bi-card-list"></i>
                <p>No items yet. Add your first item above.</p>
              </div>
            }
          } @else {
            @for (tmpl of _menuTemplates(); track tmpl.id) {
              @if (tmpl.id === _selectedTemplateId()) {
                <h2>{{ tmpl.name }}</h2>
                <p class="step-subtitle">{{ tmpl.description }}</p>
                <div class="template-categories">
                  @for (cat of tmpl.categories; track cat.name) {
                    <div class="template-category">
                      <h5>{{ cat.name }}</h5>
                      <div class="template-items">
                        @for (item of cat.items; track item.name) {
                          <div class="template-item">
                            <span>{{ item.name }}</span>
                            <span class="template-item-price">{{ item.price | currency }}</span>
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              }
            }
          }
        </div>
      }

      <!-- ============ STEP 11: Owner PIN ============ -->
      @if (currentStep() === 11) {
        <div class="step-content">
          <h2>Create your owner account</h2>
          <p class="step-subtitle">This is how you'll log in and manage your business.</p>

          <div class="form-group">
            <label for="ownerName">Display Name</label>
            <input
              id="ownerName"
              type="text"
              class="form-control"
              placeholder="Your name"
              [ngModel]="_ownerName()"
              (ngModelChange)="_ownerName.set($event)" />
          </div>

          <div class="form-group">
            <label for="ownerEmail">Email</label>
            <input
              id="ownerEmail"
              type="email"
              class="form-control"
              placeholder="owner@yourbusiness.com"
              [ngModel]="_ownerEmail()"
              (ngModelChange)="_ownerEmail.set($event)" />
          </div>

          <div class="form-group">
            <label for="ownerPassword">Password</label>
            <input
              id="ownerPassword"
              type="password"
              class="form-control"
              placeholder="Minimum 6 characters"
              [ngModel]="_ownerPassword()"
              (ngModelChange)="_ownerPassword.set($event)" />
          </div>

          <div class="pin-section">
            <label>Staff PIN (4-6 digits)</label>
            <p class="pin-hint">This PIN is used for quick staff operations like clock-in and POS access.</p>

            @if (!_pinConfirming()) {
              <label>Enter PIN</label>
              <div class="pin-display">
                @for (d of [0,1,2,3,4,5]; track $index) {
                  <span class="pin-dot" [class.filled]="d < _ownerPin().length"></span>
                }
              </div>
              <div class="pin-keypad">
                @for (d of ['1','2','3','4','5','6','7','8','9','','0','⌫']; track $index) {
                  @if (d === '') {
                    <span class="keypad-spacer"></span>
                  } @else if (d === '⌫') {
                    <button type="button" class="keypad-btn" (click)="clearPin()">
                      <i class="bi bi-backspace"></i>
                    </button>
                  } @else {
                    <button type="button" class="keypad-btn" (click)="appendPinDigit(d)">{{ d }}</button>
                  }
                }
              </div>
              @if (_ownerPin().length >= 4) {
                <button type="button" class="btn btn-primary btn-sm mt-3" (click)="confirmPinEntry()">Continue</button>
              }
            } @else if (!pinMatch() && _ownerPinConfirm().length < _ownerPin().length) {
              <label>Confirm PIN</label>
              <div class="pin-display">
                @for (d of [0,1,2,3,4,5]; track $index) {
                  <span class="pin-dot" [class.filled]="d < _ownerPinConfirm().length"></span>
                }
              </div>
              <div class="pin-keypad">
                @for (d of ['1','2','3','4','5','6','7','8','9','','0','⌫']; track $index) {
                  @if (d === '') {
                    <span class="keypad-spacer"></span>
                  } @else if (d === '⌫') {
                    <button type="button" class="keypad-btn" (click)="clearConfirmPin()">
                      <i class="bi bi-backspace"></i>
                    </button>
                  } @else {
                    <button type="button" class="keypad-btn" (click)="appendConfirmDigit(d)">{{ d }}</button>
                  }
                }
              </div>
              <button type="button" class="btn btn-sm btn-outline mt-3" (click)="clearPin()">
                <i class="bi bi-arrow-counterclockwise"></i> Re-enter PIN
              </button>
            } @else {
              @if (pinMatch()) {
                <div class="pin-match success"><i class="bi bi-check-circle"></i> PINs match</div>
                <button type="button" class="btn btn-sm btn-outline mt-2" (click)="clearPin()">Change PIN</button>
              } @else {
                <div class="pin-match error">
                  <i class="bi bi-x-circle"></i> PINs don't match
                  <button type="button" class="btn btn-sm btn-outline" style="margin-left: 0.75rem" (click)="clearPin()">Try again</button>
                </div>
              }
            }
          </div>
        </div>
      }

      <!-- ============ STEP 12: Confirmation ============ -->
      @if (currentStep() === 12) {
        <div class="step-content">
          <h2>Review & confirm</h2>
          <p class="step-subtitle">Everything look right? You can edit any section by clicking it.</p>

          <div class="review-sections">
            <div class="review-section" (click)="goToStep(1)">
              <div class="review-label">Business</div>
              <div class="review-value">{{ _businessName() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(2)">
              <div class="review-label">Business Type</div>
              <div class="review-value">{{ getBusinessTypeLabel() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(3)">
              <div class="review-label">Annual Revenue</div>
              <div class="review-value">{{ getRevenueLabel() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(4)">
              <div class="review-label">Setup Level</div>
              <div class="review-value">{{ getComplexityLabel() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(5)">
              <div class="review-label">POS Mode</div>
              <div class="review-value">{{ getModeLabel() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(6)">
              <div class="review-label">Tax</div>
              <div class="review-value">{{ _taxLocale().taxRate }}% &middot; {{ _taxLocale().currency }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(8)">
              <div class="review-label">Payments</div>
              <div class="review-value">{{ getPaymentLabel() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(9)">
              <div class="review-label">Menu</div>
              <div class="review-value">{{ getTemplateName() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>

            <div class="review-section" (click)="goToStep(11)">
              <div class="review-label">Owner</div>
              <div class="review-value">{{ _ownerName() }}</div>
              <div class="review-detail">{{ _ownerEmail() }}</div>
              <i class="bi bi-pencil edit-icon"></i>
            </div>
          </div>

          @if (_submitError()) {
            <div class="alert alert-danger">{{ _submitError() }}</div>
          }
        </div>
      }
    </div>

    <!-- Navigation Footer -->
    <div class="wizard-footer">
      @if (currentStep() > 1) {
        <button class="btn btn-outline" (click)="prev()">
          <i class="bi bi-arrow-left"></i> Back
        </button>
      } @else {
        <span></span>
      }

      @if (currentStep() < totalSteps) {
        <button
          class="btn btn-primary"
          [disabled]="!canProceed()"
          (click)="next()">
          Continue <i class="bi bi-arrow-right"></i>
        </button>
      } @else {
        <button
          class="btn btn-primary btn-lg"
          [disabled]="!canProceed() || _isSubmitting()"
          (click)="submit()">
          @if (_isSubmitting()) {
            <i class="bi bi-arrow-repeat spin"></i> Creating...
          } @else {
            <i class="bi bi-rocket-takeoff"></i> Get Started
          }
        </button>
      }
    </div>
  }
</div>
