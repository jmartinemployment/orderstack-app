<div class="setup-wizard">
  <!-- Brand + Progress -->
  <div class="wizard-brand">
    <i class="bi bi-stack"></i> OrderStack
  </div>
  <div class="wizard-header">
    <div class="progress-bar-container">
      <div class="progress-bar-fill" [style.width.%]="progressPercent()"></div>
    </div>
    <div class="step-label">
      <span>Step {{ currentStep() }} of {{ totalSteps }}</span>
      <span>{{ progressPercent() }}% complete</span>
    </div>
  </div>

  <div class="wizard-body">
    <!-- ============ STEP 1: Business Name + Address ============ -->
    @if (currentStep() === 1) {
      <div class="step-content welcome-step">
        <h2>Welcome to OrderStack!</h2>
        <p class="step-subtitle">Let's shape this thing to fit your business.</p>

        <div class="form-group">
          <label for="businessName">Your business name</label>
          <input
            id="businessName"
            type="text"
            class="form-control"
            placeholder="e.g. Taipa Kitchen"
            [ngModel]="_businessName()"
            (ngModelChange)="_businessName.set($event)" />
          <p class="field-hint">This is how we'll identify you on emails, receipts, and messages to your customers.</p>
        </div>

        <div class="address-section">
          <label>Business address</label>
          <input
            type="text"
            class="form-control"
            placeholder="Street address"
            [ngModel]="_businessAddress()"
            (ngModelChange)="_businessAddress.set($event)"
            [disabled]="_noPhysicalAddress()" />

          <div class="no-address-check">
            <input
              type="checkbox"
              id="noAddress"
              class="form-check-input"
              [ngModel]="_noPhysicalAddress()"
              (ngModelChange)="_noPhysicalAddress.set($event)" />
            <label for="noAddress" class="form-check-label">I don't have a permanent business address</label>
          </div>
        </div>
      </div>
    }

    <!-- ============ STEP 2: Business Type ============ -->
    @if (currentStep() === 2) {
      <div class="step-content">
        <h2>What kind of business best describes <strong>{{ _businessName() || 'your business' }}</strong>?</h2>
        <p class="step-subtitle">This helps us set up the right features for you.</p>

        <div class="business-type-search">
          <i class="bi bi-search search-icon"></i>
          <input
            type="text"
            class="form-control search-input"
            placeholder="Search business types..."
            [ngModel]="_businessTypeSearch()"
            (ngModelChange)="_businessTypeSearch.set($event)" />
        </div>

        <div class="business-type-list">
          @for (type of filteredBusinessTypes(); track type.name) {
            <button
              type="button"
              class="business-type-item"
              [class.selected]="_selectedBusinessType()?.name === type.name"
              (click)="selectBusinessType(type)">
              <div class="bt-info">
                <span class="bt-name">{{ type.name }}</span>
                <span class="bt-vertical">{{ getVerticalLabel(type.vertical) }}</span>
              </div>
              @if (_selectedBusinessType()?.name === type.name) {
                <i class="bi bi-check-circle-fill bt-check"></i>
              }
            </button>
          }
          @if (filteredBusinessTypes().length === 0) {
            <div class="bt-empty">
              <p>No results for "{{ _businessTypeSearch() }}"</p>
            </div>
          }
        </div>
      </div>
    }

    <!-- ============ STEP 3: Annual Revenue ============ -->
    @if (currentStep() === 3) {
      <div class="step-content">
        <h2>What's your annual revenue?</h2>
        <p class="step-subtitle">This helps us recommend the right plan and features. No judgment — we serve businesses of all sizes.</p>

        <div class="revenue-cards">
          @for (range of revenueRanges; track range.id) {
            <button
              type="button"
              class="revenue-card"
              [class.selected]="_selectedRevenue() === range.id"
              (click)="selectRevenue(range.id)">
              <span class="revenue-label">{{ range.label }}</span>
              <span class="revenue-desc">{{ range.description }}</span>
              @if (_selectedRevenue() === range.id) {
                <i class="bi bi-check-circle-fill revenue-check"></i>
              }
            </button>
          }
        </div>
      </div>
    }

    <!-- ============ STEP 4: Welcome Screen ============ -->
    @if (currentStep() === 4) {
      <div class="step-content welcome-screen">
        <div class="welcome-hero">
          <div class="welcome-icon">
            <i class="bi bi-rocket-takeoff-fill"></i>
          </div>
          <h2>Let's get growing, {{ _businessName() || 'friend' }}!</h2>
          <p class="step-subtitle">Your account is almost ready. You can finish setting up payments, items, and more from your dashboard.</p>
        </div>

        <div class="welcome-actions">
          <button
            type="button"
            class="btn btn-primary btn-lg welcome-cta"
            [disabled]="_isSubmitting()"
            (click)="submitAndContinue()">
            @if (_isSubmitting()) {
              <i class="bi bi-arrow-repeat spin"></i> Setting up...
            } @else {
              Set up payments <i class="bi bi-arrow-right"></i>
            }
          </button>
          <button
            type="button"
            class="btn btn-link skip-link"
            [disabled]="_isSubmitting()"
            (click)="skipToHome()">
            I'll do this later
          </button>
        </div>

        @if (_submitError()) {
          <div class="alert alert-danger mt-3">{{ _submitError() }}</div>
        }
      </div>
    }

    <!-- Step 5 is never shown — submitAndContinue navigates away -->
  </div>

  <!-- Navigation Footer -->
  @if (currentStep() < 4) {
    <div class="wizard-footer">
      @if (currentStep() > 1) {
        <button class="btn btn-outline" (click)="prev()">
          <i class="bi bi-arrow-left"></i> Back
        </button>
      } @else {
        <span></span>
      }

      <button
        class="btn btn-primary"
        [disabled]="!canProceed()"
        (click)="next()">
        Continue <i class="bi bi-arrow-right"></i>
      </button>
    </div>
  }
</div>
