<div class="pin-overlay" (click)="onCancel()">
  <div class="pin-modal" (click)="$event.stopPropagation()">
    <div class="pin-header">
      <h5>{{ title() }}</h5>
      <p class="text-muted mb-0">{{ message() }}</p>
    </div>

    <div class="pin-display">
      @for (i of [0, 1, 2, 3]; track i) {
        <span class="pin-dot" [class.filled]="pin().length > i"></span>
      }
      @if (pin().length > 4) {
        @for (i of [4, 5]; track i) {
          <span class="pin-dot" [class.filled]="pin().length > i"></span>
        }
      }
    </div>

    @if (error()) {
      <div class="pin-error">{{ error() }}</div>
    }

    <div class="pin-keypad">
      @for (digit of ['1','2','3','4','5','6','7','8','9']; track digit) {
        <button
          type="button"
          class="pin-key"
          [disabled]="isValidating()"
          (click)="onDigit(digit)">
          {{ digit }}
        </button>
      }
      <button
        type="button"
        class="pin-key pin-key-action"
        [disabled]="isValidating()"
        (click)="onClear()">
        CLR
      </button>
      <button
        type="button"
        class="pin-key"
        [disabled]="isValidating()"
        (click)="onDigit('0')">
        0
      </button>
      <button
        type="button"
        class="pin-key pin-key-action"
        [disabled]="isValidating()"
        (click)="onBackspace()">
        <i class="bi bi-backspace"></i>
      </button>
    </div>

    <div class="pin-actions">
      <button
        type="button"
        class="btn btn-outline-secondary"
        [disabled]="isValidating()"
        (click)="onCancel()">
        Cancel
      </button>
      <button
        type="button"
        class="btn btn-primary"
        [disabled]="pin().length < 4 || isValidating()"
        (click)="onSubmit()">
        @if (isValidating()) {
          <span class="spinner-border spinner-border-sm me-1"></span>
        }
        Authorize
      </button>
    </div>
  </div>
</div>
