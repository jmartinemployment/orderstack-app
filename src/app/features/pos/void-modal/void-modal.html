<div class="modal-overlay" (click)="onCancel()">
  <div class="modal-panel" (click)="$event.stopPropagation()">
    <div class="modal-header-bar">
      <h5>{{ mode() === 'void' ? 'Void Item' : 'Comp Item' }}</h5>
      <button type="button" class="btn-close btn-close-white" (click)="onCancel()"></button>
    </div>

    <div class="modal-body-content">
      <!-- Item info -->
      <div class="item-info mb-3">
        <span class="item-name">{{ itemName() }}</span>
        <span class="item-price">{{ itemPrice() | currency }}</span>
      </div>

      @if (mode() === 'void') {
        <!-- Void reason -->
        <div class="mb-3">
          <label class="form-label">Reason for void</label>
          <div class="reason-grid">
            @for (opt of voidReasons; track opt.value) {
              <button
                type="button"
                class="reason-btn"
                [class.active]="reason() === opt.value"
                (click)="setReason(opt.value)">
                {{ opt.label }}
              </button>
            }
          </div>
        </div>

        @if (reason() === 'other') {
          <div class="mb-3">
            <input
              type="text"
              class="form-control"
              placeholder="Describe reason..."
              [value]="customReason()"
              (input)="setCustomReason($any($event.target).value)">
          </div>
        }
      } @else {
        <!-- Comp reason -->
        <div class="mb-3">
          <label class="form-label">Reason for comp</label>
          <input
            type="text"
            class="form-control"
            placeholder="e.g., Birthday, VIP guest, quality issue..."
            [value]="customReason()"
            (input)="setCustomReason($any($event.target).value)">
        </div>

        <div class="comp-note mb-3">
          <i class="bi bi-info-circle"></i>
          Item will remain on the ticket at $0.00 for reporting purposes.
        </div>
      }

      <!-- Manager PIN section -->
      @if (needsPin()) {
        <div class="pin-section mb-3">
          <label class="form-label">Manager PIN</label>
          <input
            type="password"
            class="form-control pin-input"
            maxlength="6"
            placeholder="Enter PIN"
            [value]="pin()"
            (input)="setPin($any($event.target).value)">
        </div>
      }

      @if (error()) {
        <div class="alert alert-danger py-2 mb-0">{{ error() }}</div>
      }
    </div>

    <div class="modal-footer-bar">
      <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">Cancel</button>
      <button
        type="button"
        class="btn"
        [class.btn-danger]="mode() === 'void'"
        [class.btn-warning]="mode() === 'comp'"
        (click)="onConfirm()">
        @if (!needsPin() && requireManagerPin()) {
          Next
        } @else {
          {{ mode() === 'void' ? 'Void Item' : 'Comp Item' }}
        }
      </button>
    </div>
  </div>
</div>
