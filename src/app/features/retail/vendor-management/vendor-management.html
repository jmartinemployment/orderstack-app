<div class="vendor-mgmt">
  <div class="page-header">
    <h1>Vendor Management</h1>
    <button class="btn-primary" (click)="openCreateVendor()">
      <i class="bi bi-plus-lg"></i> Add Vendor
    </button>
  </div>

  <!-- KPI -->
  <div class="kpi-strip">
    <div class="kpi-chip">
      <span class="kpi-num">{{ vendors().length }}</span>
      <span class="kpi-label">Total Vendors</span>
    </div>
    <div class="kpi-chip">
      <span class="kpi-num">{{ activeVendorCount() }}</span>
      <span class="kpi-label">Active</span>
    </div>
  </div>

  <!-- Search -->
  <div class="filter-bar">
    <div class="search-wrap">
      <i class="bi bi-search"></i>
      <input
        type="text"
        placeholder="Search vendors..."
        [ngModel]="searchQuery()"
        (ngModelChange)="updateSearch($event)"
      />
    </div>
  </div>

  <!-- Vendor List -->
  <div class="vendor-grid">
    @for (vendor of filteredVendors(); track vendor.id) {
      <div class="vendor-card" [class.inactive]="!vendor.isActive">
        <div class="vendor-card-header">
          <div class="vendor-name">{{ vendor.name }}</div>
          <div class="vendor-actions">
            <button class="btn-icon" title="Edit" (click)="openEditVendor(vendor)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn-icon" title="View Details" (click)="openVendorDetail(vendor.id)">
              <i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
        @if (vendor.contactName) {
          <div class="vendor-contact">{{ vendor.contactName }}</div>
        }
        <div class="vendor-meta">
          @if (vendor.email) {
            <span><i class="bi bi-envelope"></i> {{ vendor.email }}</span>
          }
          @if (vendor.phone) {
            <span><i class="bi bi-telephone"></i> {{ vendor.phone }}</span>
          }
        </div>
        <div class="vendor-footer">
          @if (vendor.paymentTerms) {
            <span class="badge badge-secondary">{{ vendor.paymentTerms }}</span>
          }
          @if (vendor.leadTimeDays) {
            <span class="badge badge-info">{{ vendor.leadTimeDays }}d lead time</span>
          }
          <span class="badge" [class.badge-success]="vendor.isActive" [class.badge-muted]="!vendor.isActive">
            {{ vendor.isActive ? 'Active' : 'Inactive' }}
          </span>
        </div>
      </div>
    } @empty {
      <div class="empty-state">
        <i class="bi bi-truck"></i>
        <p>No vendors yet. Add your first vendor to start managing supply chain.</p>
        <button class="btn-primary" (click)="openCreateVendor()">
          <i class="bi bi-plus-lg"></i> Add Vendor
        </button>
      </div>
    }
  </div>

  <!-- Vendor Detail Panel -->
  @if (detailVendor(); as vendor) {
    <div class="detail-panel-backdrop" (click)="closeVendorDetail()">
      <div class="detail-panel" (click)="$event.stopPropagation()">
        <div class="detail-header">
          <h2>{{ vendor.name }}</h2>
          <button class="btn-close" (click)="closeVendorDetail()"><i class="bi bi-x-lg"></i></button>
        </div>
        <div class="detail-body">
          <div class="detail-section">
            <h3>Contact</h3>
            @if (vendor.contactName) { <div class="detail-row"><span>Name</span><span>{{ vendor.contactName }}</span></div> }
            @if (vendor.email) { <div class="detail-row"><span>Email</span><span>{{ vendor.email }}</span></div> }
            @if (vendor.phone) { <div class="detail-row"><span>Phone</span><span>{{ vendor.phone }}</span></div> }
            @if (vendor.address) { <div class="detail-row"><span>Address</span><span>{{ vendor.address }}</span></div> }
          </div>
          <div class="detail-section">
            <h3>Terms</h3>
            <div class="detail-row"><span>Payment Terms</span><span>{{ vendor.paymentTerms ?? 'Not set' }}</span></div>
            <div class="detail-row"><span>Lead Time</span><span>{{ vendor.leadTimeDays ? vendor.leadTimeDays + ' days' : 'Not set' }}</span></div>
          </div>
          @if (vendor.notes) {
            <div class="detail-section">
              <h3>Notes</h3>
              <p class="detail-notes">{{ vendor.notes }}</p>
            </div>
          }
          <div class="detail-actions">
            <button class="btn-outline" (click)="openEditVendor(vendor)">
              <i class="bi bi-pencil"></i> Edit
            </button>
            <button class="btn-outline" (click)="toggleVendorActive(vendor)">
              {{ vendor.isActive ? 'Deactivate' : 'Activate' }}
            </button>
            <button class="btn-danger-sm" (click)="deleteVendor(vendor.id)">
              <i class="bi bi-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Vendor Modal -->
  @if (showVendorModal()) {
    <div class="modal-backdrop" (click)="closeVendorModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ editingVendorId() ? 'Edit Vendor' : 'Add Vendor' }}</h3>
          <button class="btn-close" (click)="closeVendorModal()"><i class="bi bi-x-lg"></i></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Name *</label>
            <input type="text" [ngModel]="formName()" (ngModelChange)="updateFormName($event)" placeholder="Vendor name" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Contact Name</label>
              <input type="text" [ngModel]="formContactName()" (ngModelChange)="updateFormContact($event)" />
            </div>
            <div class="form-group">
              <label>Phone</label>
              <input type="tel" [ngModel]="formPhone()" (ngModelChange)="updateFormPhone($event)" />
            </div>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [ngModel]="formEmail()" (ngModelChange)="updateFormEmail($event)" />
          </div>
          <div class="form-group">
            <label>Address</label>
            <textarea [ngModel]="formAddress()" (ngModelChange)="updateFormAddress($event)" rows="2"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Payment Terms</label>
              <select [ngModel]="formPaymentTerms()" (ngModelChange)="updateFormTerms($event)">
                <option value="">Select...</option>
                <option value="Net 15">Net 15</option>
                <option value="Net 30">Net 30</option>
                <option value="Net 45">Net 45</option>
                <option value="Net 60">Net 60</option>
                <option value="COD">COD</option>
                <option value="Prepaid">Prepaid</option>
              </select>
            </div>
            <div class="form-group">
              <label>Lead Time (days)</label>
              <input type="number" min="0" [ngModel]="formLeadTimeDays()" (ngModelChange)="updateFormLeadTime($event)" />
            </div>
          </div>
          <div class="form-group">
            <label>Notes</label>
            <textarea [ngModel]="formNotes()" (ngModelChange)="updateFormNotes($event)" rows="3" placeholder="Internal notes..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-outline" (click)="closeVendorModal()">Cancel</button>
          <button class="btn-primary" (click)="saveVendor()" [disabled]="!formName()">
            {{ editingVendorId() ? 'Save Changes' : 'Add Vendor' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
