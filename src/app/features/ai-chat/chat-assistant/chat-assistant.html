@if (isAuthenticated()) {
<div class="chat-assistant">
  <!-- Header -->
  <div class="chat-header d-flex justify-content-between align-items-center">
    <div>
      <h2 class="h5 mb-0">AI Assistant</h2>
      <small class="text-muted">Ask anything about your restaurant</small>
    </div>
    @if (hasMessages()) {
      <button type="button" class="btn btn-sm btn-outline-secondary" (click)="clearChat()">
        Clear Chat
      </button>
    }
  </div>

  <!-- Messages Area -->
  <div class="chat-messages" #messagesContainer>
    @if (!hasMessages()) {
      <!-- Welcome Screen -->
      <div class="welcome-screen">
        <div class="welcome-icon">AI</div>
        <h4>Restaurant IQ Assistant</h4>
        <p class="text-muted">I can help you analyze sales, check inventory, review menu performance, and more.</p>

        <div class="suggested-queries">
          <p class="small text-muted mb-2">Try asking:</p>
          @for (query of suggestedQueries; track query) {
            <button
              type="button"
              class="btn btn-sm btn-outline-info suggestion-btn"
              [disabled]="isTyping()"
              (click)="sendSuggested(query)"
            >
              {{ query }}
            </button>
          }
        </div>
      </div>
    } @else {
      @for (msg of messages(); track msg.id) {
        <div class="chat-message" [class.message-user]="msg.role === 'user'" [class.message-assistant]="msg.role === 'assistant'">
          <div class="message-avatar">
            @if (msg.role === 'user') {
              You
            } @else {
              AI
            }
          </div>
          <div class="message-content">
            <div class="message-text">{{ msg.content }}</div>
            @if (msg.sources && msg.sources.length > 0) {
              <div class="message-sources small mt-1">
                <span class="text-muted">Sources: </span>
                @for (source of msg.sources; track source) {
                  <span class="badge bg-secondary me-1">{{ source }}</span>
                }
              </div>
            }
            <span class="message-time">{{ formatTime(msg.timestamp) }}</span>
          </div>
        </div>
      }

      @if (isTyping()) {
        <div class="chat-message message-assistant">
          <div class="message-avatar">AI</div>
          <div class="message-content">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      }
    }
  </div>

  <!-- Input Area -->
  <div class="chat-input">
    <div class="input-wrapper">
      <input
        type="text"
        class="form-control"
        placeholder="Ask about sales, inventory, menu performance..."
        [value]="inputValue()"
        [disabled]="isTyping()"
        (input)="onInput($event)"
        (keydown)="onKeydown($event)"
      />
      <button
        type="button"
        class="btn btn-primary send-btn"
        [disabled]="!inputValue().trim() || isTyping()"
        (click)="send()"
      >
        @if (isTyping()) {
          <span class="spinner-border spinner-border-sm"></span>
        } @else {
          Send
        }
      </button>
    </div>
  </div>
</div>
} @else {
<div class="auth-required d-flex align-items-center justify-content-center p-5">
  <div class="text-center">
    <h3 class="text-warning mb-3">Authentication Required</h3>
    <p class="text-light">Please log in to use the AI Assistant.</p>
  </div>
</div>
}
