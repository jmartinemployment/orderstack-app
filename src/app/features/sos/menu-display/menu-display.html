@if (isAuthenticated()) {
  <div class="menu-display">
    <!-- Category Navigation -->
    <nav class="category-nav">
      <div class="d-flex align-items-center gap-2 overflow-auto py-2 px-3">
        @for (category of categories(); track category.id) {
          <button
            type="button"
            class="btn category-pill"
            [class.active]="selectedCategory()?.id === category.id"
            (click)="selectCategory(category.id)"
          >
            @if (category.icon) {
              <span class="me-1">{{ category.icon }}</span>
            }
            {{ category.name }}
          </button>
        }
      </div>
    </nav>

    @if (error()) {
      <div class="p-3">
        <os-error-display
          [message]="error()!"
          [retryable]="true"
          (dismissed)="clearError()"
          (retry)="retry()"
        />
      </div>
    }

    @if (isLoading()) {
      <div class="d-flex justify-content-center p-5">
        <os-loading-spinner message="Loading menu..." />
      </div>
    } @else {
      <!-- Menu Items with Subcategory Ribbons -->
      <div class="menu-items-container p-3">
        @if (subcategories().length > 0) {
          @for (subcategory of subcategories(); track subcategory.id) {
            <div class="subcategory-section mb-4">
              <div class="ribbon-header d-flex align-items-center mb-3">
                <div class="ribbon-line"></div>
                <span class="ribbon-text px-3">
                  {{ currentLanguage() === 'en' && subcategory.nameEn ? subcategory.nameEn : subcategory.name }}
                </span>
                <div class="ribbon-line"></div>
              </div>

              <div class="menu-items-grid">
                @for (item of (subcategory.items ?? []); track item.id) {
                  <os-menu-item-card
                    [item]="item"
                    (addToCart)="onAddToCart($event)"
                  />
                } @empty {
                  <div class="empty-state text-center p-3">
                    <p class="text-muted mb-0 small">No items in this section</p>
                  </div>
                }
              </div>
            </div>
          }
        } @else if (displayItems().length > 0) {
          <div class="menu-items-grid">
            @for (item of displayItems(); track item.id) {
              <os-menu-item-card
                [item]="item"
                (addToCart)="onAddToCart($event)"
              />
            }
          </div>
        } @else {
          <div class="empty-state text-center p-4">
            <p class="text-muted mb-0">No items in this category</p>
          </div>
        }
      </div>
    }
  </div>
} @else {
  <div class="auth-required d-flex align-items-center justify-content-center p-5">
    <div class="text-center">
      <h3 class="text-warning mb-3">Authentication Required</h3>
      <p class="text-light">Please log in to view the menu.</p>
    </div>
  </div>
}
