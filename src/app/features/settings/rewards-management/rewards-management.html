<div class="rewards-management">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Rewards Catalog</h5>
    <button class="btn btn-sm btn-primary" (click)="openAddModal()">+ Add Reward</button>
  </div>

  @if (rewards().length === 0) {
    <div class="text-muted text-center py-4">
      No rewards configured. Add rewards that customers can redeem with their points.
    </div>
  } @else {
    <div class="table-responsive">
      <table class="table table-dark table-sm">
        <thead>
          <tr>
            <th>Name</th>
            <th>Points Cost</th>
            <th>Discount</th>
            <th>Min Tier</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (reward of rewards(); track reward.id) {
            <tr>
              <td>
                {{ reward.name }}
                @if (reward.description) {
                  <small class="d-block text-muted">{{ reward.description }}</small>
                }
              </td>
              <td>{{ reward.pointsCost }} pts</td>
              <td>
                @if (reward.discountType === 'fixed') {
                  ${{ reward.discountValue }} off
                } @else {
                  {{ reward.discountValue }}% off
                }
              </td>
              <td>
                <span class="tier-badge" [attr.data-tier]="reward.minTier">
                  {{ getTierLabel(reward.minTier) }}
                </span>
              </td>
              <td class="text-end">
                @if (deleteConfirmId() === reward.id) {
                  <span class="text-danger me-2">Delete?</span>
                  <button class="btn btn-sm btn-danger me-1" (click)="deleteReward(reward.id)">Yes</button>
                  <button class="btn btn-sm btn-outline-secondary" (click)="cancelDelete()">No</button>
                } @else {
                  <button class="btn btn-sm btn-outline-light me-1" (click)="openEditModal(reward)">Edit</button>
                  <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(reward.id)">Delete</button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Add/Edit Modal -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h5>{{ isEditing() ? 'Edit Reward' : 'Add Reward' }}</h5>

        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" [(ngModel)]="name" placeholder="e.g., Free Appetizer" />
        </div>

        <div class="mb-3">
          <label class="form-label">Description (optional)</label>
          <input type="text" class="form-control" [(ngModel)]="description" placeholder="e.g., Any appetizer up to $12" />
        </div>

        <div class="mb-3">
          <label class="form-label">Points Cost</label>
          <input type="number" class="form-control" [(ngModel)]="pointsCost" min="1" />
        </div>

        <div class="row mb-3">
          <div class="col-6">
            <label class="form-label">Discount Type</label>
            <select class="form-select" [(ngModel)]="discountType">
              <option value="fixed">Fixed ($)</option>
              <option value="percentage">Percentage (%)</option>
            </select>
          </div>
          <div class="col-6">
            <label class="form-label">Discount Value</label>
            <input type="number" class="form-control" [(ngModel)]="discountValue" min="0.01" step="0.01" />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Minimum Tier</label>
          <select class="form-select" [(ngModel)]="minTier">
            @for (tier of tiers; track tier) {
              <option [value]="tier">{{ getTierLabel(tier) }}</option>
            }
          </select>
        </div>

        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-outline-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveReward()" [disabled]="!name || pointsCost < 1 || discountValue <= 0">
            {{ isEditing() ? 'Update' : 'Create' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
