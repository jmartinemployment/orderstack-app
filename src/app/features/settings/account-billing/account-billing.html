@if (isLoading() && !subscription()) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
} @else if (subscription(); as sub) {
  <div class="account-billing">
    <div class="plan-card os-card">
      <div class="plan-header">
        <div class="plan-info">
          <h3 class="plan-name">{{ sub.planName }}</h3>
          <span class="badge" [class]="statusClass()">{{ statusLabel() }}</span>
        </div>
        @if (!isTrial()) {
          <div class="plan-price">
            <span class="amount">{{ formattedAmount() }}</span>
          </div>
        }
      </div>

      @if (isTrial()) {
        <div class="trial-section">
          <div class="trial-info">
            <span class="trial-days">{{ trialDaysRemaining() }} days remaining</span>
            <span class="trial-label">of 14-day free trial</span>
          </div>
          <div class="progress trial-progress">
            <div
              class="progress-bar"
              role="progressbar"
              [style.width.%]="trialProgress()"
              [attr.aria-valuenow]="trialProgress()"
              aria-valuemin="0"
              aria-valuemax="100">
            </div>
          </div>
        </div>
      }

      @if (isCanceled()) {
        <div class="canceled-notice">
          <i class="bi bi-info-circle"></i>
          Access until {{ sub.currentPeriodEnd | date:'longDate' }}
        </div>
      } @else if (!isTrial()) {
        <div class="billing-detail">
          <span class="detail-label">Next billing date</span>
          <span class="detail-value">{{ sub.currentPeriodEnd | date:'longDate' }}</span>
        </div>
      }

      <div class="plan-actions">
        @if (!isCanceled()) {
          <button class="btn btn-outline-danger btn-sm" (click)="openCancelModal()">
            Cancel Subscription
          </button>
        }
        <button class="btn btn-outline-primary btn-sm" disabled>
          Change Plan
        </button>
      </div>
    </div>
  </div>

  @if (showCancelModal()) {
    <os-cancel-subscription (closed)="closeCancelModal()" />
  }
}
